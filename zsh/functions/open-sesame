#!/bin/zsh

function update-emacs-buffers() {
  print-info "Reverting Emacs buffers."
  if emacsclient --no-wait --alternate-editor=false \
                 --quiet --eval '(revbufs)'; then
    print-success "Emacs buffers updated."
  else
    print-error "emacs didn't revert buffers.  Is emacs started?"
  fi
}

function update-lesskey() {
  if command-exists lesskey && [[ -f "$HOME/.lesskey" ]]; then
    lesskey
  else
    print-error "Can't find lesskey or missing ~/.lesskey file."
  fi
}

# Command to get this workstation synchronized with the latest changes dotfile
# changes.
function open-sesame() {
  print-info "Welcome back! Lets get you up to speed..."
  echo
  if command-exists "open-sesame-system" > /dev/null; then
    open-sesame-system
    echo
  else
    print-info "No system specific open-sesame function found."
    echo
  fi
  update-lesskey
  echo
  update-git-repo "${DOTFILES_DIR}"
  echo
  update-git-repo "${DOTFILES_WORK_DIR}"
  echo
  update-git-repo "${HOME}/gdrive"
  echo
  update-git-repo "${HOME}/prog/eslint-closure"
  echo
  update-emacs-buffers
  echo
  dotfiles-update-symlinks
  echo
  reload-zshrc
  echo
  echo
  print-success "You're five-by-five, good-to-go."
}

open-sesame "$@"
