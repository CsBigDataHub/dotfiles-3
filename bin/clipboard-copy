#!/bin/zsh

# Copies data to clipboard from stdin.
function clipboard-copy() {
  emulate -L zsh

  local clipper_port=8377
  if is-ssh && is-port-in-use $clipper_port; then
    # Pipe to the clipper instance.
    nc localhost $clipper_port
    return
  fi

  if ! has-display; then
    print 'ERROR: No display, so no clipboard exists.'
    return 1
  fi

  if is-darwin; then
    pbcopy
  elif is-cygwin; then
    cat > /dev/clipboard
  else
    if command-exists xclip; then
      xclip -in -selection clipboard
    elif command-exists xsel; then
      xsel --clipboard --input
    else
      local message="clipboard-copy: Platform $(uname -s) not supported or "
      message+="xclip/xsel not installed"
      print message >&2
      return 1
    fi
  fi
}

clipboard-copy $@
