# Tmux config file

conf_dir="$HOME/.config/tmux"

# Enable mouse selection and option toggling.
setw -g mouse on
setw -g mode-keys vi

set-window-option -g xterm-keys on

# Increase history because memory is cheap.
set-option -g history-limit 10000

# Use C-t as the prefix because it's less useful than C-b.
unbind C-b
set -g prefix C-t

# Start windows numbering at 1.
set -g base-index 1         
# Start pane numbering at 1.
setw -g pane-base-index 1   
# Re-number windows when a window is closed.
set -g renumber-windows on


# Enable 256 colors.
set -g default-terminal "xterm-256color"
# Needed for cursors changes.
set -g -a terminal-overrides ',*:Ss=\E[%p1%d q:Se=\E[2 q'

set-option -g default-shell /bin/zsh

if-shell 'is-darwin' 'source-file ~/.config/tmux/osx.conf'

# move x clipboard into tmux paste buffer
bind C-p run "tmux set-buffer \"$(xclip -o)\"; tmux paste-buffer"
# move tmux copy buffer into x clipboard
bind C-y run "tmux show-buffer | xclip -i"

# Copy / Paste
bind-key C-t copy-mode

# Hack to allow me to exit copy-mode with C-g.  As long as it doesn't
# interfere with the X clipboard selection, I don't care about
# clobbering any other selections.
bind-key -T copy-mode-vi 'C-g' send -X copy-pipe "/dev/null"

bind P paste-buffer
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'y' send -X copy-pipe "xclip -in -selection clipboard"
bind-key -T copy-mode-vi 'C-v' send -X rectangle-toggle
bind-key -T copy-mode-vi 'H' send -X start-of-line
bind-key -T copy-mode-vi 'L' send -X end-of-line
# Hack because command sequences aren't supported for specified modes
# https://github.com/tmux/tmux/issues/215
bind-key -T root J if-shell -F "#{pane_in_mode}" "send-keys jjjjj" "send-keys J"
bind-key -T root K if-shell -F "#{pane_in_mode}" "send-keys kkkkk" "send-keys K"

bind-key -T copy-mode-vi 'C-j' send -X page-down
bind-key -T copy-mode-vi 'C-k' send -X page-up
bind-key -T copy-mode-vi 'Y' send -X copy-end-of-line
bind + delete-buffer

# new-session -d -n ranger -s dev ranger
# new-window -d

# Window and pane management

# Special tokens for windows
# Token              Meaning
# {start}       ^    The lowest-numbered window
# {end}         $    The highest-numbered window
# {last}        !    The last (previously current) window
# {next}        +    The next window by number
# {previous}    -    The previous window by number


# Select windows.
bind-key -T root -r C-M-l next-window
bind-key -T root -r C-M-h previous-window

# Kill the current window.
bind-key x kill-window

bind-key -T root M-/ split-window -h
bind-key -T root M-- split-window -v

# Special tokens for panes
# {last}            !    The last (previously active) pane
# {next}            +    The next pane by number
# {previous}        -    The previous pane by number
# {top}                  The top pane
# {bottom}               The bottom pane
# {left}                 The leftmost pane
# {right}                The rightmost pane
# {top-left}             The top-left pane
# {top-right}            The top-right pane
# {bottom-left}          The bottom-left pane
# {bottom-right}         The bottom-right pane
# {up-of}                The pane above the active pane
# {down-of}              The pane below the active pane
# {left-of}              The pane to the left of the active pane
# {right-of}             The pane to the right of the active pane

# Select panes with vi movement commands.
bind-key -T root -r M-h select-pane -L
bind-key -T root -r M-j select-pane -D
bind-key -T root -r M-k select-pane -U
bind-key -T root -r M-l select-pane -R

# Move panes around within a window and follow the moving pane.
bind-key -T root -r M-H swap-pane -t {left-of}  \; select-pane -t {left-of}
bind-key -T root -r M-J swap-pane -t {down-of}  \; select-pane -t {down-of}
bind-key -T root -r M-K swap-pane -t {up-of}    \; select-pane -t {up-of}
bind-key -T root -r M-L swap-pane -t {right-of} \; select-pane -t {right-of}

# Move current pane into a new window in the specified direction.
bind-key -T root M-Left  break-pane \; select-window -t {last}
bind-key -T root M-Right break-pane \; select-window -t {last} \; move-window -r -t {last}

# Pull one pane from the specified direction into current window.  Reverses the
# command above.
bind-key -T root M-S-Left  join-pane -s :{previous} 
bind-key -T root M-S-Right join-pane -s :{next} 

# Pull a pane into current window as a new pane.
bind-key @ command-prompt -p "create pane from:"  "join-pane -s ':%%'"

# Small pane resizes.
bind-key -T root C-Left  resize-pane -L 2
bind-key -T root C-Down  resize-pane -D 2
bind-key -T root C-Up    resize-pane -U 2
bind-key -T root C-Right resize-pane -R 2

# Large pane resizes.
bind-key -T root C-S-Up    resize-pane -U 8
bind-key -T root C-S-Down  resize-pane -D 8 
bind-key -T root C-S-Left  resize-pane -L 8
bind-key -T root C-S-Right resize-pane -R 8

# Kill panes with a dedicated key.
bind-key -T root -r C-M-k kill-pane

# Layouts
bind-key -T root M-Up   next-layout
bind-key -T root M-Down previous-layout

# Status bar
set -g status-left-length 32
set -g status-right-length 150
set -g status-left '#[fg=white][#S] '
set -g window-status-format " #I:#W "
set -g window-status-current-format "#[bg=#00533A] #I:#W "
set -g status-right ''

# Colors
set -g status-fg white
set -g status-bg '#18191b'
set -g window-status-activity-attr bold
# set -g window-style 'bg=#00171d'
set -g window-active-style 'bg=colour0'
set -g pane-border-fg colour245
set -g pane-active-border-fg blue
set -g message-fg yellow
set -g message-bg '#18191b'


set -g @prefix_highlight_show_copy_mode 'on'

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-copycat'
# set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'tmux-plugins/tmux-open'
# set -g @plugin 'jschaf/tmux-newline-detector'
set -g @plugin 'jbnicolai/tmux-fpp'
set -g @plugin 'tmux-plugins/tmux-resurrect'
# Enable continuous saving of tmux environment, automatic restore when tmux is
# started.
set -g @plugin 'tmux-plugins/tmux-continuum'
# Enable logging of panes, text-capture of current pane and saving complete
# history.
set -g @plugin 'tmux-plugins/tmux-logging'

set -g @prefix_highlight_bg 'blue'  # default is 'colour04'
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_copy_mode_attr 'fg=black,bg=yellow,bold' # default is 'fg=default,bg=yellow'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'